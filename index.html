<!-- 
  Copyright Â© [2025] [Dustin_Chen]. All rights reserved.
  Author: Dustin Chen
  Email:  chuhpsdustin@gmail.com
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºç«™é…ç½®è½‰æ›å·¥å…·</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
        }
        
        .input-section, .output-section {
            flex: 1;
            min-width: 300px;
            padding: 20px;
        }
        
        .input-section {
            border-right: 1px solid #eaeaea;
        }
        
        h2 {
            color: #2a5298;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeaea;
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s;
            background-color: #f9f9f9;
        }
        
        .upload-area:hover {
            border-color: #2a5298;
            background-color: #f0f5ff;
        }
        
        .upload-area i {
            font-size: 48px;
            color: #2a5298;
            margin-bottom: 15px;
        }
        
        .upload-text {
            margin-bottom: 15px;
        }
        
        .btn {
            display: inline-block;
            background: #2a5298;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #1e3c72;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        textarea {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .output-area {
            position: relative;
        }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(42, 82, 152, 0.8);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .copy-btn:hover {
            background: #2a5298;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            font-size: 0.9rem;
            border-top: 1px solid #eaeaea;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #eaeaea;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>NR 5G RAN Tool: confdb_v2.xml_To_OAI_conf</h1>
			<p style="margin: 0; color: white;">ã€Authorã€‘: Dustin_Chen, ã€Emailã€‘: <a href="mailto:Dustin_Chen@compal.com" style="color: inherit; line-height: 1;">Dustin_Chen@compal.com</a> or <a href="mailto:chuhpsdustin@gmail.com" style="color: inherit; line-height: 1;">chuhpsdustin@gmail.com</a></p>
        </header>
        
        <div class="content">
            <div class="input-section">
                <h2>ä¸Šå‚³confdb_v2.xml</h2>
                
                <div class="upload-area" id="uploadArea">
                    <i>ğŸ“</i>
                    <p class="upload-text">æ‹–æ”¾è¨­å®šæª”åˆ°é€™è£¡ï¼Œæˆ–é»æ“Šä¸Šå‚³</p>
                    <input type="file" id="fileInput" accept=".txt,.xml,.conf" style="display: none;">
                    <button class="btn" id="uploadBtn">é¸æ“‡æª”</button>
                </div>
                
                <p>æˆ–è€…ç›´æ¥åœ¨ä¸‹æ–¹è¼¸å…¥é…ç½®å…§å®¹ï¼š</p>
                <textarea id="inputText" placeholder="ç²˜è²¼æ‚¨çš„XMLé…ç½®å…§å®¹åˆ°é€™è£¡..."></textarea>
                
                <div class="button-group">
                    <button class="btn" id="convertBtn">è½‰æ›ç‚ºOAIæ ¼å¼</button>
                    <button class="btn btn-secondary" id="clearBtn">æ¸…é™¤å…§å®¹</button>
                </div>
            </div>
            
            <div class="output-section">
                <h2>è¼¸å‡ºè½‰æ›æˆOAI conf</h2>
                <div class="output-area">
                    <textarea id="outputText" placeholder="è½‰æ›å¾Œçš„OAIé…ç½®å°‡é¡¯ç¤ºåœ¨é€™è£¡..." readonly></textarea>
                    <button class="copy-btn" id="copyBtn">è¤‡è£½</button>
                </div>
                
                <div class="button-group">
                    <button class="btn" id="downloadBtn">ä¸‹è¼‰è¨­å®šæª”</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>åŸºç«™é…ç½®è½‰æ›å·¥å…· Copyright Â© [2025] [Dustin_Chen]. All rights reserved. | æ”¯æ´XMLåˆ°OAIé…ç½®æ ¼å¼è½‰æ›</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            const uploadBtn = document.getElementById('uploadBtn');
            const uploadArea = document.getElementById('uploadArea');
            const inputText = document.getElementById('inputText');
            const outputText = document.getElementById('outputText');
            const convertBtn = document.getElementById('convertBtn');
            const clearBtn = document.getElementById('clearBtn');
            const copyBtn = document.getElementById('copyBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            
            // è¨­ç½®é è¨­å…§å®¹
            inputText.value = `            <RF>
              <NRARFCNDL>723324</NRARFCNDL>
              <PhyCellID>30</PhyCellID>
              <DLBandwidth>100</DLBandwidth>
              <ULBandwidth>100</ULBandwidth>
              <PSCHPowerOffset>db0</PSCHPowerOffset>
              <NRARFCNUL>723324</NRARFCNUL>
              <FreqBandIndicator>79</FreqBandIndicator>
              <SsPBCHBlockPower>-35</SsPBCHBlockPower>
              <ForgetFactorRbNoise>8</ForgetFactorRbNoise>
              <SsbFrequency xsi:nil="true"/>
              <gNBDUId xsi:nil="true"/>
              <DigitalBeamFormingMode>false</DigitalBeamFormingMode>
              <AnalogBeamformingMode>false</AnalogBeamformingMode>
              <BandwidthAutoConfig>false</BandwidthAutoConfig>
            </RF>
            <PHY>
              <FrequencyInfoDLSIB>
                <OffsetToPointA>5</OffsetToPointA>
                <MultiFrequencyBandListNRSIB id="1">
                  <FreqBandIndicatorNR>12</FreqBandIndicatorNR>
                </MultiFrequencyBandListNRSIB>
                <ScsSpecificCarrierList id="1">
                  <SCSSpecificCarrier>
                    <OffsetToCarrier>0</OffsetToCarrier>
                    <SubcarrierSpacing>1</SubcarrierSpacing>
                    <CarrierBandwidth>273</CarrierBandwidth>
                  </SCSSpecificCarrier>
                </ScsSpecificCarrierList>
              </FrequencyInfoDLSIB>
              <FrequencyInfoULSIB>
                <AbsoluteFrequencyPointA>720048</AbsoluteFrequencyPointA>
                <ScsSpecificCarrierList id="1">
                  <SCSSpecificCarrier>
                    <OffsetToCarrier>0</OffsetToCarrier>
                    <SubcarrierSpacing>1</SubcarrierSpacing>
                    <CarrierBandwidth>273</CarrierBandwidth>
                  </SCSSpecificCarrier>
                </ScsSpecificCarrierList>
                <IsPMaxPresent>true</IsPMaxPresent>
                <Pmax>23</Pmax>
              </FrequencyInfoULSIB>
              <SSB>
                <SsbPositionsInBurst>
                  <InOneGroup>8</InOneGroup>
                </SsbPositionsInBurst>
                <SsbPeriodicityServingCell>3</SsbPeriodicityServingCell>
                <SsPBCHBlockPower>-36</SsPBCHBlockPower>
                <SsbSubcarrierOffset>9</SsbSubcarrierOffset>
              </SSB>
              <SubCarrierSpacingCommon>scs30or120</SubCarrierSpacingCommon>
              <TddULDLConfigurationCommon>
                <ReferenceSubcarrierSpacing>1</ReferenceSubcarrierSpacing>
                <IsPattern2Present>true</IsPattern2Present>
                <pattern1>
                  <DlULTransmissionPeriodicity>8</DlULTransmissionPeriodicity>
                  <NrofDownlinkSlots>3</NrofDownlinkSlots>
                  <NrofDownlinkSymbols>6</NrofDownlinkSymbols>
                  <NrofUplinkSlots>2</NrofUplinkSlots>
                  <NrofUplinkSymbols>4</NrofUplinkSymbols>
                </pattern1>
                <pattern2>
                  <DlULTransmissionPeriodicity>4</DlULTransmissionPeriodicity>
                  <NrofDownlinkSlots>4</NrofDownlinkSlots>
                  <NrofDownlinkSymbols>0</NrofDownlinkSymbols>
                  <NrofUplinkSlots>0</NrofUplinkSlots>
                  <NrofUplinkSymbols>0</NrofUplinkSymbols>
                </pattern2>
              </TddULDLConfigurationCommon>`;
            
            // ä¸Šå‚³æŒ‰éˆ•é»æ“Šäº‹ä»¶
            uploadBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            // æª”é¸æ“‡äº‹ä»¶
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        inputText.value = e.target.result;
                    };
                    reader.readAsText(file);
                }
            });
            
            // æ‹–æ”¾åŠŸèƒ½
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.style.borderColor = '#2a5298';
                uploadArea.style.backgroundColor = '#f0f5ff';
            });
            
            uploadArea.addEventListener('dragleave', function() {
                uploadArea.style.borderColor = '#ccc';
                uploadArea.style.backgroundColor = '#f9f9f9';
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.style.borderColor = '#ccc';
                uploadArea.style.backgroundColor = '#f9f9f9';
                
                const file = e.dataTransfer.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        inputText.value = e.target.result;
                    };
                    reader.readAsText(file);
                }
            });
            
            // è½‰æ›æŒ‰éˆ•é»æ“Šäº‹ä»¶
            convertBtn.addEventListener('click', function() {
                const input = inputText.value;
                if (!input.trim()) {
                    alert('è«‹è¼¸å…¥é…ç½®å…§å®¹');
                    return;
                }
                
                // èª¿ç”¨è½‰æ›å‡½æ•¸
                const oaiConfig = convertToOAI(input);
                outputText.value = oaiConfig;
            });
            
            // æ¸…é™¤æŒ‰éˆ•é»æ“Šäº‹ä»¶
            clearBtn.addEventListener('click', function() {
                inputText.value = '';
                outputText.value = '';
            });
            
            // è¤‡è£½æŒ‰éˆ•é»æ“Šäº‹ä»¶
            copyBtn.addEventListener('click', function() {
                outputText.select();
                document.execCommand('copy');
                alert('é…ç½®å·²è¤‡è£½åˆ°å‰ªè²¼æ¿');
            });
            
            // ä¸‹è¼‰æŒ‰éˆ•é»æ“Šäº‹ä»¶
            downloadBtn.addEventListener('click', function() {
                const content = outputText.value;
                if (!content.trim()) {
                    alert('æ²’æœ‰å…§å®¹å¯ä¸‹è¼‰');
                    return;
                }
                
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'oai_config.conf';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // XMLåˆ°OAIé…ç½®è½‰æ›å‡½æ•¸
            function convertToOAI(xmlContent) {
                // æå–é—œéµåƒæ•¸
                const phyCellId = extractValue(xmlContent, 'PhyCellID') || '30';
                const freqBand = extractValue(xmlContent, 'FreqBandIndicator') || '79';
                const nrarfcnDl = extractValue(xmlContent, 'NRARFCNDL') || '723324';
                const nrarfcnUl = extractValue(xmlContent, 'NRARFCNUL') || '723324';
                
                // æå–é »ç‡ç›¸é—œåƒæ•¸
                const absoluteFrequencyPointA = extractValue(xmlContent, 'AbsoluteFrequencyPointA') || '720048';
                const ssbPower = extractValue(xmlContent, 'SsPBCHBlockPower') || '-35';
                
                // æå–TDDé…ç½®åƒæ•¸ - ä½¿ç”¨æ”¹é€²çš„è§£ææ–¹æ³•
                const tddParams = extractTddParameters(xmlContent);
                
                // æå–SSBç›¸é—œåƒæ•¸
                const ssbPositionsInBurst = extractValue(xmlContent, 'InOneGroup') || '8';
                const ssbPeriodicityServingCell = extractValue(xmlContent, 'SsbPeriodicityServingCell') || '3';
                
                // æå–PDCCHé…ç½®åƒæ•¸
                const controlResourceSetZero = extractValue(xmlContent, 'ControlResourceSetZero') || '10';
                const pdcchConfigSIB1 = extractValue(xmlContent, 'PdcchConfigSIB1') || '160';
                
                // æå–PRACHé…ç½®åƒæ•¸
                const preambleTransMax = extractValue(xmlContent, 'PreambleTransMax') || '3';
                const prachConfigurationIndex = extractValue(xmlContent, 'PrachConfigurationIndex') || '147';
                const p0NominalWithGrant = extractValue(xmlContent, 'P0NominalWithGrant') || '-96';
                const msg3Alpha = extractValue(xmlContent, 'Msg3Alpha') || 'alpha0';
                
                // æå–MACå±¤åƒæ•¸
                const srPeriod = extractValue(xmlContent, 'SrPeriod') || '20';
                const layerOneEntryMcs = extractValue(xmlContent, 'LayerOneEntryMcs') || '7';
                const layerOneLeaveMcs = extractValue(xmlContent, 'LayerOneLeaveMcs') || '17';
                const layerTwoEntryMcs = extractValue(xmlContent, 'LayerTwoEntryMcs') || '10';
                const layerTwoLeaveMcs = extractValue(xmlContent, 'LayerTwoLeaveMcs') || '9';
                
                // æå–èšåˆç´šåˆ¥åƒæ•¸
                const aggregationLevel4 = extractValue(xmlContent, 'AggregationLevel4') || '4';
                const aggregationLevel8 = extractValue(xmlContent, 'AggregationLevel8') || '2';
                const aggregationLevel16 = extractValue(xmlContent, 'AggregationLevel16') || '1';
                
                // æå–å®šæ™‚å™¨åƒæ•¸
                const ueInactiveTimer = extractValue(xmlContent, 'UeInactiveTimer') || '30';
                
                // è¨ˆç®—SSBé »ç‡ï¼ˆåŸºæ–¼NRARFCNå’Œé »æ®µï¼‰
                let absoluteFrequencySSB;
                if (nrarfcnDl === '723324') {
                    absoluteFrequencySSB = '720288'; // å°æ‡‰é »æ®µ79
                } else {
                    absoluteFrequencySSB = '644736'; // é è¨­å€¼ï¼Œå°æ‡‰é »æ®µ78
                }
                
                // æ ¹æ“šé »æ®µèª¿æ•´åƒæ•¸
                let bandsValue = '[79]';
                if (freqBand === '78') {
                    bandsValue = '[78]';
                }
                
                // æ ¹æ“šNRARFCNåˆ¤æ–·é…ç½®é¡å‹
                let configType = 'æ–‡ä»¶2é…ç½®';
                if (nrarfcnDl === '647484') {
                    configType = 'æ–‡ä»¶1é…ç½®';
                }
                
                // ç”ŸæˆOAIé…ç½®
                return `# OAIé…ç½®æ–‡ä»¶ - ${configType}
# ç”Ÿæˆæ™‚é–“: ${new Date().toISOString()}
# æºåƒæ•¸: NRARFCNDL=${nrarfcnDl}, PhyCellID=${phyCellId}, é »æ®µ=${freqBand}

Active_gNBs = ( "du-rfsim");
# Asn1_verbosity, choice in: none, info, annoying
Asn1_verbosity = "none";

gNBs =
(
 {
    ////////// Identification parameters:
    gNB_ID = 0xe00;
    gNB_DU_ID = 0xe00;
    gNB_name  =  "du-rfsim";

    // Tracking area code, 0x0000 and 0xfffe are reserved values
    tracking_area_code  =  1;
    plmn_list = ({ mcc = 001; mnc = 01; mnc_length = 2; snssaiList = ({ sst = 1; }) });

    nr_cellid = 647169L;

    ////////// Physical parameters:

    min_rxtxtime = 6;

    servingCellConfigCommon = (
    {
 #spCellConfigCommon

      physCellId                                               = ${phyCellId};

#  downlinkConfigCommon
    #frequencyInfoDL
      # this is the SSB frequency
      absoluteFrequencySSB                                      = ${absoluteFrequencySSB};
      dl_frequencyBand                                          = ${freqBand};
      # this is the Point A frequency
      dl_absoluteFrequencyPointA                                = ${absoluteFrequencyPointA};
      #scs-SpecificCarrierList
        dl_offstToCarrier                                       = 0;
# subcarrierSpacing
# 0=kHz15, 1=kHz30, 2=kHz60, 3=kHz120
        dl_subcarrierSpacing                                    = 1;
        dl_carrierBandwidth                                     = 273;
     #initialDownlinkBWP
      #genericParameters
        # this is RBstart=27,L=48 (275*(L-1))+RBstart
        initialDLBWPlocationAndBandwidth                         = 1099;
# subcarrierSpacing
# 0=kHz15, 1=kHz30, 2=kHz60, 3=kHz120
        initialDLBWPsubcarrierSpacing                             = 1;
      #pdcch-ConfigCommon
        initialDLBWPcontrolResourceSetZero                        = ${controlResourceSetZero};
        initialDLBWPsearchSpaceZero                               = 0;

  #uplinkConfigCommon
     #frequencyInfoUL
      ul_frequencyBand                                             = ${freqBand};
      #scs-SpecificCarrierList
      ul_offstToCarrier                                            = 0;
# subcarrierSpacing
# 0=kHz15, 1=kHz30, 2=kHz60, 3=kHz120
      ul_subcarrierSpacing                                         = 1;
      ul_carrierBandwidth                                          = 273;
      pMax                                                         = 23;
     #initialUplinkBWP
      #genericParameters
        initialULBWPlocationAndBandwidth                           = 1099;
# subcarrierSpacing
# 0=kHz15, 1=kHz30, 2=kHz60, 3=kHz120
        initialULBWPsubcarrierSpacing                              = 1;
      #rach-ConfigCommon
        #rach-ConfigGeneric
          prach_ConfigurationIndex                                 = ${prachConfigurationIndex};
#prach_msg1_FDM
#0 = one, 1=two, 2=four, 3=eight
          prach_msg1_FDM                                           = 0;
          prach_msg1_FrequencyStart                                = 2;
          zeroCorrelationZoneConfig                                = 10;
          preambleReceivedTargetPower                              = -90;
#preamblTransMax (0...10) = (3,4,5,6,7,8,10,20,50,100,200)
          preambleTransMax                                         = ${preambleTransMax};
#powerRampingStep
# 0=dB0,1=dB2,2=dB4,3=dB6
        powerRampingStep                                           = 2;
#ssb_perRACH_OccasionAndCB_PreamblesPerSSB_PR
#1=oneeighth,2=onefourth,3=half,4=one,5=two,6=four,7=eight,8=sixteen
        ssb_perRACH_OccasionAndCB_PreamblesPerSSB_PR               = 4;
#one (0..15) 4,8,12,16,...60,64
        ssb_perRACH_OccasionAndCB_PreamblesPerSSB                  = 7;
#ra_ContentionResolutionTimer
#(0..7) 8,16,24,32,40,48,56,64
        ra_ContentionResolutionTimer                               = 7;
        rsrp_ThresholdSSB                                          = 0;
#prach-RootSequenceIndex_PR
#1 = 839, 2 = 139
        prach_RootSequenceIndex_PR                                 = 2;
        prach_RootSequenceIndex                                    = 1;
        # SCS for msg1, can only be 15 for 30 kHz < 6 GHz, takes precendence over the one derived from prach-ConfigIndex
        #
        msg1_SubcarrierSpacing                                     = 1,
# restrictedSetConfig
# 0=unrestricted, 1=restricted type A, 2=restricted type B
        restrictedSetConfig                                        = 0,

        msg3_DeltaPreamble                                         = 0;
        p0_NominalWithGrant                                        = ${p0NominalWithGrant};
        #msg3_Alpha                                                 = ${msg3Alpha};

# pucch-ConfigCommon setup :
# pucchGroupHopping
# 0 = neither, 1= group hopping, 2=sequence hopping
        pucchGroupHopping                                          = 0;
        hoppingId                                                  = 40;
        p0_nominal                                                 = -96;

      ssb_PositionsInBurst_Bitmap                                  = ${calculateSsbBitmap(ssbPositionsInBurst)};

# ssb_periodicityServingCell
# 0 = ms5, 1=ms10, 2=ms20, 3=ms40, 4=ms80, 5=ms160, 6=spare2, 7=spare1
      ssb_periodicityServingCell                                   = ${convertSsbPeriodicity(ssbPeriodicityServingCell)};

# dmrs_TypeA_position
# 0 = pos2, 1 = pos3
      dmrs_TypeA_Position                                           = 0;

# subcarrierSpacing
# 0=kHz15, 1=kHz30, 2=kHz60, 3=kHz120
      subcarrierSpacing                                            = 1;

  #tdd-UL-DL-ConfigurationCommon
# subcarrierSpacing
# 0=kHz15, 1=kHz30, 2=kHz60, 3=kHz120
      referenceSubcarrierSpacing                                   = 1;

      # pattern1
      # dl_UL_TransmissionPeriodicity
      # 0=ms0p5, 1=ms0p625, 2=ms1, 3=ms1p25, 4=ms2, 5=ms2p5, 6=ms5, 7=ms10
      # ext: 8=ms3, 9=ms4
      dl_UL_TransmissionPeriodicity                                = ${tddParams.pattern1.dlUlPeriodicity};
      nrofDownlinkSlots                                            = ${tddParams.pattern1.nrofDownlinkSlots};
      nrofDownlinkSymbols                                          = ${tddParams.pattern1.nrofDownlinkSymbols};
      nrofUplinkSlots                                              = ${tddParams.pattern1.nrofUplinkSlots};
      nrofUplinkSymbols                                            = ${tddParams.pattern1.nrofUplinkSymbols};

      # pattern2
      pattern2: {
        dl_UL_TransmissionPeriodicity2                             = ${tddParams.pattern2.dlUlPeriodicity};
        nrofDownlinkSlots2                                         = ${tddParams.pattern2.nrofDownlinkSlots};
        nrofDownlinkSymbols2                                       = ${tddParams.pattern2.nrofDownlinkSymbols};
        nrofUplinkSlots2                                           = ${tddParams.pattern2.nrofUplinkSlots};
        nrofUplinkSymbols2                                         = ${tddParams.pattern2.nrofUplinkSymbols};
      };

      ssPBCH_BlockPower                                            = ${ssbPower};
     }

  );

    # ------- SCTP definitions
    SCTP :
    {
        # Number of streams to use in input/output
        SCTP_INSTREAMS  = 2;
        SCTP_OUTSTREAMS = 2;
    };
  }
);

MACRLCs = ({
    num_cc              = 1;
    tr_s_preference     = "local_L1";
    tr_n_preference     = "f1";
    local_n_address     = "127.0.0.4";
    remote_n_address    = "127.0.0.3";
    local_n_portd       = 2152;
    remote_n_portd      = 2152;
    pusch_FailureThres  = 1000;
    
    # MACå±¤åƒæ•¸
    sr_Period           = ${srPeriod};
    layerOne_EntryMcs   = ${layerOneEntryMcs};
    layerOne_LeaveMcs   = ${layerOneLeaveMcs};
    layerTwo_EntryMcs   = ${layerTwoEntryMcs};
    layerTwo_LeaveMcs   = ${layerTwoLeaveMcs};
    
    # èšåˆç´šåˆ¥é…ç½®
    aggregation_Level4  = ${aggregationLevel4};
    aggregation_Level8  = ${aggregationLevel8};
    aggregation_Level16 = ${aggregationLevel16};
});

L1s = ({
    num_cc = 1;
    tr_n_preference = "local_mac";
    prach_dtx_threshold = 200;
    pucch0_dtx_threshold = 150;
    ofdm_offset_divisor = 8; #set this to UINT_MAX for offset 0
});

RUs = ({
    local_rf       = "yes"
    nb_tx          = 1
    nb_rx          = 1
    att_tx         = 0
    att_rx         = 0;
    bands          = ${bandsValue};
    max_pdschReferenceSignalPower = -27;
    max_rxgain                    = 114;
    eNB_instances  = [0];
    clock_src = "internal";
});

rfsimulator: {
  serveraddr = "server";
  serverport = 4043;
  options = (); #("saviq"); or/and "chanmod"
  modelname = "AWGN";
  IQfile = "/tmp/rfsimulator.iqs"
}

log_config: {
  global_log_level = "info";
  hw_log_level     = "info";
  nr_phy_log_level = "info";
  nr_mac_log_level = "info";
  rlc_log_level    = "info";
  pdcch_log_level  = "info";
  rrc_log_level    = "info";
  f1ap_log_level   = "info";
  ngap_log_level   = "debug";
};

# å®šæ™‚å™¨é…ç½®
timer_config: {
  ue_inactive_timer = ${ueInactiveTimer};
};

e2_agent = {
  near_ric_ip_addr = "127.0.0.1";
  sm_dir = "/usr/local/lib/flexric/"
};`;
            }
            
            // å¾XMLå…§å®¹ä¸­æå–å€¼çš„è¼”åŠ©å‡½æ•¸
            function extractValue(xmlContent, tagName) {
                // ç§»é™¤å¯èƒ½çš„å‘½åç©ºé–“å‰ç¶´
                const cleanContent = xmlContent.replace(/xsi:nil="true"/g, '');
                const regex = new RegExp(`<${tagName}>([^<]*)</${tagName}>`, 'i');
                const match = cleanContent.match(regex);
                return match ? match[1].trim() : null;
            }
            
            // æå–TDDåƒæ•¸çš„æ”¹é€²å‡½æ•¸
            function extractTddParameters(xmlContent) {
                // é»˜èªå€¼
                const defaultParams = {
                    pattern1: {
                        dlUlPeriodicity: '8',
                        nrofDownlinkSlots: '3',
                        nrofDownlinkSymbols: '6',
                        nrofUplinkSlots: '2',
                        nrofUplinkSymbols: '4'
                    },
                    pattern2: {
                        dlUlPeriodicity: '4',
                        nrofDownlinkSlots: '4',
                        nrofDownlinkSymbols: '0',
                        nrofUplinkSlots: '0',
                        nrofUplinkSymbols: '0'
                    }
                };
                
                // é¦–å…ˆå˜—è©¦å¾pattern1å’Œpattern2ä¸­æå–
                const pattern1Content = extractPatternContent(xmlContent, 'pattern1');
                const pattern2Content = extractPatternContent(xmlContent, 'pattern2');
                
                if (pattern1Content) {
                    defaultParams.pattern1.dlUlPeriodicity = extractValue(pattern1Content, 'DlULTransmissionPeriodicity') || defaultParams.pattern1.dlUlPeriodicity;
                    defaultParams.pattern1.nrofDownlinkSlots = extractValue(pattern1Content, 'NrofDownlinkSlots') || defaultParams.pattern1.nrofDownlinkSlots;
                    defaultParams.pattern1.nrofDownlinkSymbols = extractValue(pattern1Content, 'NrofDownlinkSymbols') || defaultParams.pattern1.nrofDownlinkSymbols;
                    defaultParams.pattern1.nrofUplinkSlots = extractValue(pattern1Content, 'NrofUplinkSlots') || defaultParams.pattern1.nrofUplinkSlots;
                    defaultParams.pattern1.nrofUplinkSymbols = extractValue(pattern1Content, 'NrofUplinkSymbols') || defaultParams.pattern1.nrofUplinkSymbols;
                }
                
                if (pattern2Content) {
                    defaultParams.pattern2.dlUlPeriodicity = extractValue(pattern2Content, 'DlULTransmissionPeriodicity') || defaultParams.pattern2.dlUlPeriodicity;
                    defaultParams.pattern2.nrofDownlinkSlots = extractValue(pattern2Content, 'NrofDownlinkSlots') || defaultParams.pattern2.nrofDownlinkSlots;
                    defaultParams.pattern2.nrofDownlinkSymbols = extractValue(pattern2Content, 'NrofDownlinkSymbols') || defaultParams.pattern2.nrofDownlinkSymbols;
                    defaultParams.pattern2.nrofUplinkSlots = extractValue(pattern2Content, 'NrofUplinkSlots') || defaultParams.pattern2.nrofUplinkSlots;
                    defaultParams.pattern2.nrofUplinkSymbols = extractValue(pattern2Content, 'NrofUplinkSymbols') || defaultParams.pattern2.nrofUplinkSymbols;
                }
                
                // è½‰æ›é€±æœŸæ€§åƒæ•¸
                defaultParams.pattern1.dlUlPeriodicity = convertDlUlPeriodicity(defaultParams.pattern1.dlUlPeriodicity);
                defaultParams.pattern2.dlUlPeriodicity = convertDlUlPeriodicity(defaultParams.pattern2.dlUlPeriodicity);
                
                return defaultParams;
            }
            
            // æå–patternå…§å®¹çš„è¼”åŠ©å‡½æ•¸
            function extractPatternContent(xmlContent, patternName) {
                const regex = new RegExp(`<${patternName}>([\\s\\S]*?)</${patternName}>`, 'i');
                const match = xmlContent.match(regex);
                return match ? match[1] : null;
            }
            
            // è¨ˆç®—SSBé»é™£åœ–çš„è¼”åŠ©å‡½æ•¸
            function calculateSsbBitmap(ssbPositions) {
                const positions = parseInt(ssbPositions);
                if (positions === 8) return '128'; // å°æ‡‰8å€‹SSBä½ç½®
                if (positions === 4) return '15';  // å°æ‡‰4å€‹SSBä½ç½®
                return '128'; // é è¨­å€¼
            }
            
            // è½‰æ›SSBé€±æœŸæ€§çš„è¼”åŠ©å‡½æ•¸
            function convertSsbPeriodicity(periodicity) {
                const period = parseInt(periodicity);
                // 0 = ms5, 1=ms10, 2=ms20, 3=ms40, 4=ms80, 5=ms160, 6=spare2, 7=spare1
                if (period === 3) return '2'; // ms20
                if (period === 2) return '2'; // ms20
                return '2'; // é»˜èªms20
            }
            
            // è½‰æ›DL-ULå‚³è¼¸é€±æœŸæ€§çš„è¼”åŠ©å‡½æ•¸
            function convertDlUlPeriodicity(periodicity) {
                const period = parseInt(periodicity);
                // 0=ms0p5, 1=ms0p625, 2=ms1, 3=ms1p25, 4=ms2, 5=ms2p5, 6=ms5, 7=ms10
                // ext: 8=ms3, 9=ms4
                if (period === 8) return '8'; // ms3
                if (period === 4) return '4'; // ms2
                if (period === 5) return '5'; // ms2.5
                return '5'; // é»˜èªms2.5
            }
        });
    </script>
</body>
</html>